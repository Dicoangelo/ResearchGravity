name: Research CI

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  validate:
    name: Validate Research Framework
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Validate Scripts
        run: |
          echo "üîç Validating Python syntax..."
          python -m py_compile scripts/session/init_session.py
          python -m py_compile scripts/session/log_url.py
          python -m py_compile scripts/session/status.py
          python -m py_compile scripts/session/archive_session.py
          python -m py_compile scripts/session/sync_environments.py
          echo "‚úÖ All scripts valid"

      - name: Test Init Session (Dry Run)
        run: |
          echo "üß™ Testing init_session.py --help..."
          python scripts/session/init_session.py --help

      - name: Test Status Script
        run: |
          echo "üß™ Testing status.py..."
          python scripts/session/status.py || true  # May fail without session, that's ok

      - name: Framework Health Check
        run: |
          echo "üìä Framework Health Check"
          echo "========================="
          echo "README.md exists: $(test -f README.md && echo '‚úÖ' || echo '‚ùå')"
          echo "SKILL.md exists: $(test -f docs/SKILL.md && echo '‚úÖ' || echo '‚ùå')"
          echo "Scripts: $(find scripts -name '*.py' | wc -l) files"
          echo "Modules: $(ls -1d */ 2>/dev/null | wc -l) directories"
          echo "========================="
          echo "‚úÖ ResearchGravity ‚Äî Metaventions AI"

  quality-gate:
    name: Metaventions Quality Gate
    runs-on: ubuntu-latest
    needs: validate

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Check Documentation Standards
        run: |
          echo "üìù Checking documentation standards..."

          # Check SKILL.md has required sections
          if grep -q "Cold Start Protocol" docs/SKILL.md; then
            echo "‚úÖ Cold Start Protocol documented"
          else
            echo "‚ö†Ô∏è Missing Cold Start Protocol"
          fi

          if grep -q "Source Hierarchy" docs/SKILL.md; then
            echo "‚úÖ Source Hierarchy documented"
          else
            echo "‚ö†Ô∏è Missing Source Hierarchy"
          fi

          if grep -q "Quality Checklist" docs/SKILL.md; then
            echo "‚úÖ Quality Checklist documented"
          else
            echo "‚ö†Ô∏è Missing Quality Checklist"
          fi

          echo "‚úÖ Documentation standards verified"

      - name: Metaventions Brand Check
        run: |
          echo "üé® Verifying Metaventions AI branding..."

          if grep -q "Metaventions AI" README.md; then
            echo "‚úÖ Brand present in README"
          fi

          if grep -q "dicoangelo@metaventionsai.com" docs/SKILL.md; then
            echo "‚úÖ Contact info present"
          fi

          echo "‚úÖ Brand verification complete"
